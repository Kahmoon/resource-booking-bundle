"use strict";var resourceBookingApp=new Vue({el:"#resourceBookingApp",data:{now:{tstamp:"",date:"",time:""},lastUserRequest:{tstamp:"",date:"",datim:"",time:""},isReady:false,loggedInUser:[],resourceIsAvailable:true,requestToken:"",weekdays:[],activeWeek:{},timeSlots:[],rows:[],activeResource:{},activeResourceType:{},bookingRepeatsSelection:[],bookingFormValidation:[],bookingModal:{},form:{}},created:function created(){var self=this;self.requestToken=RESOURCE_BOOKING.requestToken;window.setInterval(function(){self.getTime()},1e3);self.getDataAll();window.setTimeout(function(){self.lastUserRequest.tstamp=self.now.tstamp},1100);window.setInterval(function(){if(self.lastUserRequest.tstamp+600>self.now.tstamp){self.getDataAll()}},15e3);window.setTimeout(function(){self.isReady=true},800)},methods:{getDataAll:function getDataAll(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{REQUEST_TOKEN:self.requestToken,action:"getDataAll"}});xhr.done(function(response){if(response.status==="success"){for(var key in response["data"]){self[key]=response["data"][key]}}});xhr.fail(function($res,$bl){alert("Verbindung zum Server fehlgeschlagen! Überprüfen Sie die Netzwerkverbindung bitte.")});xhr.always(function(){})},openBookingModal:function openBookingModal(objActiveTimeSlot,action){var self=this;self.bookingModal.selectedTimeSlots=[];self.bookingModal.action=action;self.bookingModal.showConfirmationMsg=false;self.bookingModal.activeTimeSlot=objActiveTimeSlot;self.bookingModal.alertSuccess="";self.bookingModal.alertError="";self.bookingModal.selectedTimeSlots.push(objActiveTimeSlot.bookingCheckboxValue);self.bookingFormValidation=[];window.setTimeout(function(){self.sendBookingFormValidationRequest()},500);$('#resourceBookingModal [name="bookingDescription"]').val("");$("#bookingRepeatStopWeekTstamp option").prop("selected",false);$('#bookingRepeatStopWeekTstamp [data-current-week="true"]').prop("selected","selected");$("#resourceBookingModal").modal("show")},sendBookingRequest:function sendBookingRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{action:"sendBookingRequest",REQUEST_TOKEN:self.requestToken,resourceId:self.bookingModal.activeTimeSlot.resourceId,description:$('#resourceBookingModal [name="bookingDescription"]').val(),bookingDateSelection:self.bookingModal.selectedTimeSlots,bookingRepeatStopWeekTstamp:$("#bookingRepeatStopWeekTstamp").val()}});xhr.done(function(response){if(response.status==="success"){self.bookingModal.alertSuccess=response.alertSuccess;window.setTimeout(function(){$("#resourceBookingModal").modal("hide")},2500)}else{self.bookingModal.alertError=response.alertError}self.lastUserRequest=response.lastUserRequest});xhr.fail(function(){alert("Verbindung zum Server fehlgeschlagen! Überprüfen Sie die Netzwerkverbindung bitte.")});xhr.always(function(){self.bookingModal.showConfirmationMsg=true;self.getDataAll()})},sendBookingFormValidationRequest:function sendBookingFormValidationRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{action:"sendBookingFormValidationRequest",REQUEST_TOKEN:self.requestToken,resourceId:self.bookingModal.activeTimeSlot.resourceId,bookingDateSelection:self.bookingModal.selectedTimeSlots,bookingRepeatStopWeekTstamp:$("#bookingRepeatStopWeekTstamp").val()}});xhr.done(function(response){if(response.status==="success"){self.bookingFormValidation=response.bookingFormValidation;self.lastUserRequest=response.lastUserRequest}});xhr.fail(function(){alert("Verbindung zum Server fehlgeschlagen! Überprüfen Sie die Netzwerkverbindung bitte.")});xhr.always(function(){})},sendCancelBookingRequest:function sendCancelBookingRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{action:"sendCancelBookingRequest",REQUEST_TOKEN:self.requestToken,bookingId:self.bookingModal.activeTimeSlot.bookingId}});xhr.done(function(response){if(response.status==="success"){self.bookingModal.alertSuccess=response.alertSuccess;window.setTimeout(function(){$("#resourceBookingModal").modal("hide")},2500)}else{self.bookingModal.alertError=response.alertError}self.lastUserRequest=response.lastUserRequest});xhr.fail(function(){alert("Verbindung zum Server fehlgeschlagen! Überprüfen Sie die Netzwerkverbindung bitte.")});xhr.always(function(){self.bookingModal.showConfirmationMsg=true;self.getDataAll()})},submitForm:function submitForm(){var self=this;document.getElementById("resourceBookingForm").submit()},getTime:function getTime(){var objDate=new Date;this.now.tstamp=objDate.getTime()/1e3;this.now.date=objDate.getDay()+"."+objDate.getMonth()+"."+objDate.getYear();this.now.time=objDate.getHours()+":"+objDate.getMinutes()+":"+objDate.getSeconds()}}});