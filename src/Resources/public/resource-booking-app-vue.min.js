"use strict";var resourceBookingApp=new Vue({el:"#resourceBookingApp",data:{isReady:false,filterBoard:null,idleTimeLimit:42e4,userLoggedOut:false,isOnline:true,loggedInUser:[],resourceIsAvailable:true,requestToken:"",weekdays:[],timeSlots:[],rows:[],activeResourceType:[],activeResource:[],activeWeek:[],bookingRepeatsSelection:[],bookingFormValidation:[],bookingModal:{},intervals:[],messages:null},created:function created(){var self=this;self.requestToken=RESOURCE_BOOKING.requestToken;self.sendDataAllRequest();self.intervals.sendDataAllRequest=window.setInterval(function(){self.sendDataAllRequest()},15e3);self.initializeIdleDetector();self.sendIsOnlineRequest();self.intervals.sendIsOnlineRequest=window.setInterval(function(){self.sendIsOnlineRequest()},6e4)},watch:{isOnline:function isOnline(val){var self=this;if(val===false){clearInterval(self.intervals.sendIsOnlineRequest);clearInterval(self.intervals.sendDataAllRequest);self.sendLogoutRequest();window.setTimeout(function(){$("#resourceBookingModal").modal("hide");window.setTimeout(function(){$("#autoLogoutModal").on("hidden.bs.modal",function(){location.reload()});$("#autoLogoutModal").modal("show")},100)},400)}}},methods:{sendDataAllRequest:function sendDataAllRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{REQUEST_TOKEN:self.requestToken,action:"sendDataAllRequest"}});xhr.done(function(response){if(response.status==="success"){for(var key in response["data"]){self[key]=response["data"][key]}}});xhr.fail(function($res,$bl){self.isOnline=false});xhr.always(function(){})},openBookingModal:function openBookingModal(objActiveTimeSlot,action){var self=this;self.bookingModal.selectedTimeSlots=[];self.bookingModal.action=action;self.bookingModal.showConfirmationMsg=false;self.bookingModal.activeTimeSlot=objActiveTimeSlot;self.bookingModal.alertSuccess="";self.bookingModal.alertError="";self.bookingModal.selectedTimeSlots.push(objActiveTimeSlot.bookingCheckboxValue);self.bookingFormValidation=[];window.setTimeout(function(){self.sendBookingFormValidationRequest()},500);$("#resourceBookingModal").on("show.bs.modal",function(){$('#resourceBookingModal [name="bookingDescription"]').val("");$("#bookingRepeatStopWeekTstamp option").prop("selected",false)});$("#resourceBookingModal").modal("show")},sendBookingRequest:function sendBookingRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{action:"sendBookingRequest",REQUEST_TOKEN:self.requestToken,resourceId:self.bookingModal.activeTimeSlot.resourceId,description:$('#resourceBookingModal [name="bookingDescription"]').val(),bookingDateSelection:self.bookingModal.selectedTimeSlots,bookingRepeatStopWeekTstamp:$("#bookingRepeatStopWeekTstamp").val()}});xhr.done(function(response){if(response.status==="success"){self.bookingModal.alertSuccess=response.alertSuccess;window.setTimeout(function(){$("#resourceBookingModal").modal("hide")},2500)}else{self.bookingModal.alertError=response.alertError}});xhr.fail(function(){alert("Verbindung zum Server fehlgeschlagen! Überprüfen Sie die Netzwerkverbindung bitte.")});xhr.always(function(){self.bookingModal.showConfirmationMsg=true;self.sendDataAllRequest()})},sendBookingFormValidationRequest:function sendBookingFormValidationRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{action:"sendBookingFormValidationRequest",REQUEST_TOKEN:self.requestToken,resourceId:self.bookingModal.activeTimeSlot.resourceId,bookingDateSelection:self.bookingModal.selectedTimeSlots,bookingRepeatStopWeekTstamp:$("#bookingRepeatStopWeekTstamp").val()}});xhr.done(function(response){if(response.status==="success"){self.bookingFormValidation=response.bookingFormValidation}});xhr.fail(function(){self.isOnline=false});xhr.always(function(){})},sendCancelBookingRequest:function sendCancelBookingRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{action:"sendCancelBookingRequest",REQUEST_TOKEN:self.requestToken,bookingId:self.bookingModal.activeTimeSlot.bookingId}});xhr.done(function(response){if(response.status==="success"){self.bookingModal.alertSuccess=response.alertSuccess;window.setTimeout(function(){$("#resourceBookingModal").modal("hide")},2500)}else{self.bookingModal.alertError=response.alertError}});xhr.fail(function(){self.isOnline=false});xhr.always(function(){self.bookingModal.showConfirmationMsg=true;self.sendDataAllRequest()})},sendIsOnlineRequest:function sendIsOnlineRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{action:"sendIsOnlineRequest",REQUEST_TOKEN:self.requestToken}});xhr.done(function(response){if(response.status==="success"){self.isOnline=response.isOnline}else{self.isOnline=false}});xhr.fail(function(){self.isOnline=false});xhr.always(function(){})},sendLogoutRequest:function sendLogoutRequest(){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{action:"sendLogoutRequest",REQUEST_TOKEN:self.requestToken}});xhr.always(function(){self.isOnline=false;self.userLoggedOut=true})},initializeIdleDetector:function initializeIdleDetector(){var self=this;$(document).idle({onIdle:function(){self.sendLogoutRequest()},idle:self.idleTimeLimit})},sendApplyFilterRequest:function sendApplyFilterRequest(tstamp){var self=this;var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{resType:$('#resourceBookingForm [name="resType"]').val(),res:$('#resourceBookingForm [name="res"]').val(),date:tstamp>0?tstamp:$('#resourceBookingForm [name="date"]').val(),action:"sendApplyFilterRequest",REQUEST_TOKEN:self.requestToken}});xhr.done(function(response){if(response.status==="success"){for(var key in response["data"]){self[key]=response["data"][key]}}else{self.isOnline=false}});xhr.fail(function(){self.isOnline=false})},sendJumpWeekRequest:function sendJumpWeekRequest(tstamp,event){var self=this;event.preventDefault();var xhr=$.ajax({url:window.location.href,type:"post",dataType:"json",data:{resType:self.activeResourceType.id,res:self.activeResource.id,date:tstamp,action:"sendApplyFilterRequest",REQUEST_TOKEN:self.requestToken}});xhr.done(function(response){if(response.status==="success"){for(var key in response["data"]){self[key]=response["data"][key]}}});xhr.fail(function(){self.isOnline=false})}}});