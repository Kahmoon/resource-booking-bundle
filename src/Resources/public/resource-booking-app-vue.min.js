"use strict";class resourceBookingApp{constructor(vueElement,params){new Vue({el:vueElement,data:{opt:[],isReady:!1,lastResponseStatus:200,filterBoard:null,userIsLoggedIn:!1,loggedInUser:[],requestToken:'',weekdays:[],timeSlots:[],rows:[],activeResourceTypeId:'undefined',activeResourceType:[],activeResourceId:'undefined',activeResource:[],activeWeekTstamp:0,activeWeek:[],bookingRepeatsSelection:[],bookingModal:[],bookingFormValidation:[],intervals:[],messages:null,isIdle:!1,isBusy:!1,},created:function created(){let self=this;let ua=window.navigator.userAgent;let msie=ua.indexOf('MSIE ');if(msie>0){alert('This plugin is not compatible with your browser. Please use a current browser (like Opera, Firefox, Safari or Google Chrome), that is not out of date.')}
        self.requestToken=params.requestToken;window.setTimeout(function(){self.fetchDataRequest()},2000);self.intervals.fetchDataRequest=window.setInterval(function(){if(!self.isIdle&&!self.isBusy){self.fetchDataRequest()}},15000);let idleAfter=300000;window.setTimeout(function(){self.initializeIdleDetector(idleAfter)},10000)},watch:{isReady:function isOnline(val){},activeResourceTypeId:function activeResourceTypeId(newObj,oldObj){this.applyFilterRequest(newObj,this.activeResourceId,this.activeWeekTstamp)},activeResourceId:function activeResourceId(newObj,oldObj){this.applyFilterRequest(this.activeResourceTypeId,newObj,this.activeWeekTstamp)},activeWeekTstamp:function activeWeekTstamp(newObj,oldObj){this.applyFilterRequest(this.activeResourceTypeId,this.activeResourceId,newObj)}},methods:{fetchDataRequest:function fetchDataRequest(){let self=this;let action='fetchDataRequest';self.isBusy=!0;let data=new FormData();data.append('REQUEST_TOKEN',self.requestToken);data.append('action',action);fetch(window.location.href,{method:"POST",body:data,headers:{'x-requested-with':'XMLHttpRequest'},}).then(function(res){self.checkResponse(res);return res.json()}).then(function(response){if(response.status==='success'){for(let key in response.data){self[key]=response.data[key]}}
            return response}).then(function(response){self.isReady=!0;self.isBusy=!1}).catch(function(error){self.isReady=!1;self.isBusy=!1})},applyFilterRequest:function applyFilterRequest(activeResourceTypeId,activeResourceId,activeWeekTstamp){let self=this;let action='applyFilterRequest';self.isBusy=!0;self.toggleBackdrop(!0);let data=new FormData();data.append('REQUEST_TOKEN',self.requestToken);data.append('action',action);data.append('resType',activeResourceTypeId);data.append('res',activeResourceId);data.append('date',activeWeekTstamp);fetch(window.location.href,{method:"POST",body:data,headers:{'x-requested-with':'XMLHttpRequest'},}).then(function(res){self.checkResponse(res);return res.json()}).then(function(response){if(response.status==='success'){for(let key in response.data){self[key]=response.data[key]}}
            return response}).then(function(response)
        {self.toggleBackdrop(!1);self.isBusy=!1}).catch(function(response){self.toggleBackdrop(!1);self.isBusy=!1})},bookingRequest:function bookingRequest(){let self=this;let action='bookingRequest';let data=new FormData();data.append('REQUEST_TOKEN',self.requestToken);data.append('action',action);data.append('resourceId',self.bookingModal.activeTimeSlot.resourceId);data.append('description',$(self.$el).find('.resource-booking-modal [name="bookingDescription"]').first().val());data.append('bookingRepeatStopWeekTstamp',$(self.$el).find('.booking-repeat-stop-week-tstamp').first().val());let i;for(i=0;i<self.bookingModal.selectedTimeSlots.length;i++){data.append('bookingDateSelection[]',self.bookingModal.selectedTimeSlots[i])}
            fetch(window.location.href,{method:"POST",body:data,headers:{'x-requested-with':'XMLHttpRequest'},}).then(function(res){self.checkResponse(res);return res.json()}).then(function(response){if(response.status==='success'){self.bookingModal.message.success=response.message.success;window.setTimeout(function(){$(self.$el).find('.resource-booking-modal').first().modal('hide')},2500)}else{self.bookingModal.message.error=response.message.error}
                self.bookingModal.showConfirmationMsg=!0;self.fetchDataRequest()}).catch(function(response){self.isReady=!1;self.bookingModal.showConfirmationMsg=!0;self.fetchDataRequest()})},bookingFormValidationRequest:function bookingFormValidationRequest(){let self=this;let action='bookingFormValidationRequest';let data=new FormData();data.append('REQUEST_TOKEN',self.requestToken);data.append('action',action);data.append('resourceId',self.bookingModal.activeTimeSlot.resourceId);data.append('bookingRepeatStopWeekTstamp',$(self.$el).find('.booking-repeat-stop-week-tstamp').first().val());let i;for(i=0;i<self.bookingModal.selectedTimeSlots.length;i++){data.append('bookingDateSelection[]',self.bookingModal.selectedTimeSlots[i])}
            fetch(window.location.href,{method:"POST",body:data,headers:{'x-requested-with':'XMLHttpRequest'},}).then(function(res){self.checkResponse(res);return res.json()}).then(function(response){if(response.status==='success'){self.bookingFormValidation=response.data;self.isReady=!0}}).catch(function(response){self.isReady=!1})},cancelBookingRequest:function cancelBookingRequest(){let self=this;let action='cancelBookingRequest';let data=new FormData();data.append('REQUEST_TOKEN',self.requestToken);data.append('action',action);data.append('bookingId',self.bookingModal.activeTimeSlot.bookingId);fetch(window.location.href,{method:"POST",body:data,headers:{'x-requested-with':'XMLHttpRequest'},}).then(function(res){self.checkResponse(res);return res.json()}).then(function(response){if(response.status==='success'){self.bookingModal.message.success=response.message.success;window.setTimeout(function(){$(self.$el).find('.resource-booking-modal').first().modal('hide')},2500)}else{self.bookingModal.message.error=response.message.error}
            self.bookingModal.showConfirmationMsg=!0;self.fetchDataRequest()}).catch(function(response){self.isReady=!1;self.bookingModal.showConfirmationMsg=!0;self.fetchDataRequest()})},jumpWeekRequest:function jumpWeekRequest(tstamp,event){let self=this;event.preventDefault();event.stopPropagation();if(self.isBusy){return!1}
            if(tstamp===self.activeWeekTstamp||tstamp<self.filterBoard.tstampFirstPossibleWeek||tstamp>self.filterBoard.tstampLastPossibleWeek)
            {return!1}
            self.activeWeekTstamp=tstamp},openBookingModal:function openBookingModal(objActiveTimeSlot,action){let self=this;self.bookingModal.selectedTimeSlots=[];self.bookingModal.action=action;self.bookingModal.showConfirmationMsg=!1;self.bookingModal.activeTimeSlot=objActiveTimeSlot;self.bookingModal.message={success:null,error:null,};self.bookingModal.selectedTimeSlots.push(objActiveTimeSlot.bookingCheckboxValue);self.bookingFormValidation=[];$(self.$el).find('.booking-preview').first().collapse('hide');window.setTimeout(function(){self.bookingFormValidationRequest()},500);$(self.$el).find('.resource-booking-modal').first().on('show.bs.modal',function(){$(self.$el).find('.resource-booking-modal [name="bookingDescription"]').first().val('');$(self.$el).find('.booking-repeat-stop-week-tstamp option').prop('selected',!1)});$(self.$el).find('.resource-booking-modal').first().modal('show')},toggleBackdrop:function toggleBackdrop(blnAdd=!0){if(blnAdd){$('.modal-backdrop').remove();let backdrop='<div class="modal-backdrop resource-booking-backdrop show"></div>';$("body").append(backdrop)}else{window.setTimeout(function(){$('.modal-backdrop').remove()},100)}},checkResponse:function checkResponse(res){this.lastResponseStatus=res.status;if(res.status!=200){this.isReady=!1}else{this.isReady=!0}},initializeIdleDetector:function initializeIdleDetector(idleAfter){let self=this;$(document).idle({onIdle:function onIdle(){self.isIdle=!0},onActive:function(){self.isIdle=!1;self.fetchDataRequest()},idle:idleAfter,})}}})}}
