"use strict";class resourceBookingApp{constructor(e,o){new Vue({el:e,data:{opt:[],isReady:!1,filterBoard:null,userLoggedOut:!1,isOnline:!1,loggedInUser:[],requestToken:"",weekdays:[],timeSlots:[],rows:[],activeResourceTypeId:"",activeResourceId:"",activeWeekTstamp:0,activeResourceType:[],activeResource:[],activeWeek:[],bookingRepeatsSelection:[],bookingFormValidation:[],bookingModal:{},intervals:[],messages:null},created:function(){let e=this;window.navigator.userAgent.indexOf("MSIE ")>0&&alert("This extension is not compatible with your browser. Please use a current browser (like Opera, Firefox, Safari or Google Chrome), that is not out of date."),o.requestToken=o.requestToken,e.fetchDataRequest(),e.intervals.fetchDataRequest=window.setInterval(function(){e.fetchDataRequest()},3e4),window.setTimeout(function(){e.initializeIdleDetector()},1e4)},watch:{isOnline:function(e){let o=this;!1===e&&(clearInterval(o.intervals.fetchDataRequest),o.sendLogoutRequest(),window.setTimeout(function(){$(o.$el).find(".resource-booking-modal").first().modal("hide"),window.setTimeout(function(){$(o.$el).find(".auto-logout-modal").first().on("hidden.bs.modal",function(){o.opt.autologout?location.href=o.opt.autologoutRedirect:location.href=""}),$(o.$el).find(".auto-logout-modal").first().modal("show")},100)},400))},activeResourceTypeId:function(e,o){this.sendApplyFilterRequest()},activeResourceId:function(e,o){this.sendApplyFilterRequest()},activeWeekTstamp:function(e,o){this.sendApplyFilterRequest()}},methods:{fetchDataRequest:function(){let e=this,o=new FormData;o.append("REQUEST_TOKEN",e.requestToken),o.append("action","fetchDataRequest"),fetch(window.location.href,{method:"POST",body:o,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(o){if("success"===o.status){for(let t in o.data)e[t]=o.data[t];e.isReady=!0}e.isOnline=!0}).catch(function(o){e.isOnline=!1})},sendBookingRequest:function(){let e,o=this,t=new FormData;for(t.append("action","sendBookingRequest"),t.append("REQUEST_TOKEN",o.requestToken),t.append("resourceId",o.bookingModal.activeTimeSlot.resourceId),t.append("description",$(o.$el).find('.resource-booking-modal [name="bookingDescription"]').first().val()),t.append("bookingRepeatStopWeekTstamp",$(o.$el).find(".booking-repeat-stop-week-tstamp").first().val()),e=0;e<o.bookingModal.selectedTimeSlots.length;e++)t.append("bookingDateSelection[]",o.bookingModal.selectedTimeSlots[e]);fetch(window.location.href,{method:"POST",body:t,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){"success"===e.status?(o.bookingModal.alertSuccess=e.alertSuccess,window.setTimeout(function(){$(o.$el).find(".resource-booking-modal").first().modal("hide")},2500)):o.bookingModal.alertError=e.alertError,o.isOnline=!0,o.bookingModal.showConfirmationMsg=!0,o.fetchDataRequest()}).catch(function(e){o.isOnline=!1,o.bookingModal.showConfirmationMsg=!0,o.fetchDataRequest()})},sendBookingFormValidationRequest:function(){let e,o=this,t=new FormData;for(t.append("action","sendBookingFormValidationRequest"),t.append("REQUEST_TOKEN",o.requestToken),t.append("resourceId",o.bookingModal.activeTimeSlot.resourceId),t.append("bookingRepeatStopWeekTstamp",$(o.$el).find(".booking-repeat-stop-week-tstamp").first().val()),e=0;e<o.bookingModal.selectedTimeSlots.length;e++)t.append("bookingDateSelection[]",o.bookingModal.selectedTimeSlots[e]);fetch(window.location.href,{method:"POST",body:t,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){"success"===e.status?(o.bookingFormValidation=e.data,o.isOnline=!0):o.isOnline=!1}).catch(function(e){o.isOnline=!1})},sendCancelBookingRequest:function(){let e=this,o=new FormData;o.append("action","sendCancelBookingRequest"),o.append("REQUEST_TOKEN",e.requestToken),o.append("bookingId",e.bookingModal.activeTimeSlot.bookingId),fetch(window.location.href,{method:"POST",body:o,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(o){"success"===o.status?(e.bookingModal.alertSuccess=o.alertSuccess,window.setTimeout(function(){$(e.$el).find(".resource-booking-modal").first().modal("hide")},2500)):e.bookingModal.alertError=o.alertError,e.bookingModal.showConfirmationMsg=!0,e.fetchDataRequest()}).catch(function(o){e.isOnline=!1,e.bookingModal.showConfirmationMsg=!0,e.fetchDataRequest()})},sendLogoutRequest:function(){let e=this,o=new FormData;o.append("action","sendLogoutRequest"),o.append("REQUEST_TOKEN",e.requestToken),fetch(window.location.href,{method:"POST",body:o,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(o){e.isOnline=!1,e.userLoggedOut=!0}).catch(function(o){e.isOnline=!1,e.userLoggedOut=!0})},sendApplyFilterRequest:function(){let e=this,o=new FormData;o.append("action","sendApplyFilterRequest"),o.append("REQUEST_TOKEN",e.requestToken),o.append("resType",e.activeResourceTypeId),o.append("res",e.activeResourceId),o.append("date",e.activeWeekTstamp),fetch(window.location.href,{method:"POST",body:o,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(o){if("success"===o.status)for(let t in o.data)e[t]=o.data[t];e.isOnline=!0}).catch(function(o){e.isOnline=!1})},sendJumpWeekRequest:function(e,o){let t=this;o.preventDefault(),$(".modal-backdrop").remove();$("body").append('<div class="modal-backdrop show"></div>');let n=new FormData;n.append("action","sendJumpWeekRequest"),n.append("REQUEST_TOKEN",t.requestToken),n.append("resType",t.activeResourceTypeId),n.append("res",t.activeResourceId),n.append("date",e),fetch(window.location.href,{method:"POST",body:n,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){if("success"===e.status)for(let o in e.data)t[o]=e.data[o];t.isOnline=!0,window.setTimeout(function(){$(".modal-backdrop").remove()},200)}).catch(function(e){t.isOnline=!1,window.setTimeout(function(){$(".modal-backdrop").remove()},200)})},initializeIdleDetector:function(){let e=this;e.opt.autologout&&parseInt(e.opt.autologoutDelay)>0&&$(document).idle({onIdle:function(){e.sendLogoutRequest()},idle:1e3*parseInt(e.opt.autologoutDelay)})},openBookingModal:function(e,o){let t=this;t.bookingModal.selectedTimeSlots=[],t.bookingModal.action=o,t.bookingModal.showConfirmationMsg=!1,t.bookingModal.activeTimeSlot=e,t.bookingModal.alertSuccess="",t.bookingModal.alertError="",t.bookingModal.selectedTimeSlots.push(e.bookingCheckboxValue),t.bookingFormValidation=[],$(t.$el).find(".booking-preview").first().collapse("hide"),window.setTimeout(function(){t.sendBookingFormValidationRequest()},500),$(t.$el).find(".resource-booking-modal").first().on("show.bs.modal",function(){$(t.$el).find('.resource-booking-modal [name="bookingDescription"]').first().val(""),$(t.$el).find(".booking-repeat-stop-week-tstamp option").prop("selected",!1)}),$(t.$el).find(".resource-booking-modal").first().modal("show")}}})}}
