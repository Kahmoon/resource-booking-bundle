"use strict";class resourceBookingApp{constructor(e,o){new Vue({el:e,data:{opt:[],isReady:!1,mode:"main-window",lastResponseStatus:200,filterBoard:null,userIsLoggedIn:!1,loggedInUser:[],requestToken:"",moduleId:"",weekdays:[],timeSlots:[],rows:[],activeResourceTypeId:"undefined",activeResourceType:[],activeResourceId:"undefined",activeResource:[],activeWeekTstamp:0,activeWeek:[],bookingRepeatsSelection:[],bookingWindow:[],bookingFormValidation:[],intervals:[],messages:null,isIdle:!1,isBusy:!1},created:function(){let e=this;window.navigator.userAgent.indexOf("MSIE ")>0&&alert("This plugin is not compatible with your browser. Please use a current browser (like Opera, Firefox, Safari or Google Chrome), that is not out of date."),e.requestToken=o.requestToken,e.moduleId=o.moduleId,window.setTimeout(function(){e.fetchDataRequest()},2e3),e.intervals.fetchDataRequest=window.setInterval(function(){e.isIdle||e.isBusy||e.fetchDataRequest()},15e3);window.setTimeout(function(){e.initializeIdleDetector(3e5)},1e4),document.addEventListener("keyup",function(o){27===o.keyCode&&"booking-window"===e.mode&&e.hideBookingWindow()})},watch:{isReady:function(e){},activeResourceTypeId:function(e,o){this.applyFilterRequest(e,this.activeResourceId,this.activeWeekTstamp)},activeResourceId:function(e,o){this.applyFilterRequest(this.activeResourceTypeId,e,this.activeWeekTstamp)},activeWeekTstamp:function(e,o){this.applyFilterRequest(this.activeResourceTypeId,this.activeResourceId,e)}},methods:{fetchDataRequest:function(){let e=this;e.isBusy=!0;let o=new FormData;o.append("REQUEST_TOKEN",e.requestToken),o.append("action","fetchDataRequest"),o.append("moduleId",e.moduleId),fetch(window.location.href,{method:"POST",body:o,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(o){return e.checkResponse(o),o.json()}).then(function(o){if("success"===o.status)for(let t in o.data)e[t]=o.data[t];return o}).then(function(o){e.isReady=!0,e.isBusy=!1}).catch(function(o){e.isReady=!1,e.isBusy=!1})},applyFilterRequest:function(e,o,t){let i=this;i.isBusy=!0,i.toggleBackdrop(!0);let n=new FormData;n.append("REQUEST_TOKEN",i.requestToken),n.append("action","applyFilterRequest"),n.append("resType",e),n.append("res",o),n.append("date",t),n.append("moduleId",i.moduleId),fetch(window.location.href,{method:"POST",body:n,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return i.checkResponse(e),e.json()}).then(function(e){if("success"===e.status)for(let o in e.data)i[o]=e.data[o];return e}).then(function(e){i.toggleBackdrop(!1),i.isBusy=!1}).catch(function(e){i.toggleBackdrop(!1),i.isBusy=!1})},bookingRequest:function(){let e,o=this,t=new FormData;for(t.append("REQUEST_TOKEN",o.requestToken),t.append("action","bookingRequest"),t.append("resourceId",o.bookingWindow.activeTimeSlot.resourceId),t.append("description",$(o.$el).find('.booking-window [name="bookingDescription"]').first().val()),t.append("bookingRepeatStopWeekTstamp",$(o.$el).find(".booking-repeat-stop-week-tstamp").first().val()),t.append("moduleId",o.moduleId),e=0;e<o.bookingWindow.selectedTimeSlots.length;e++)t.append("bookingDateSelection[]",o.bookingWindow.selectedTimeSlots[e]);fetch(window.location.href,{method:"POST",body:t,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return o.checkResponse(e),e.json()}).then(function(e){"success"===e.status?(o.bookingWindow.message.success=e.message.success,window.setTimeout(function(){o.mode="main-window"},2500)):o.bookingWindow.message.error=e.message.error,o.bookingWindow.showConfirmationMsg=!0,o.fetchDataRequest()}).catch(function(e){o.isReady=!1,o.bookingWindow.showConfirmationMsg=!0,o.fetchDataRequest()})},bookingFormValidationRequest:function(){let e,o=this,t=new FormData;for(t.append("REQUEST_TOKEN",o.requestToken),t.append("action","bookingFormValidationRequest"),t.append("resourceId",o.bookingWindow.activeTimeSlot.resourceId),t.append("bookingRepeatStopWeekTstamp",$(o.$el).find(".booking-repeat-stop-week-tstamp").first().val()),t.append("moduleId",o.moduleId),e=0;e<o.bookingWindow.selectedTimeSlots.length;e++)t.append("bookingDateSelection[]",o.bookingWindow.selectedTimeSlots[e]);fetch(window.location.href,{method:"POST",body:t,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(e){return o.checkResponse(e),e.json()}).then(function(e){"success"===e.status&&(o.bookingFormValidation=e.data,o.isReady=!0)}).catch(function(e){o.isReady=!1})},cancelBookingRequest:function(){let e=this,o=new FormData;o.append("REQUEST_TOKEN",e.requestToken),o.append("action","cancelBookingRequest"),o.append("bookingId",e.bookingWindow.activeTimeSlot.bookingId),o.append("deleteBookingsWithSameBookingUuid",e.bookingWindow.deleteBookingsWithSameBookingUuid),o.append("moduleId",e.moduleId),fetch(window.location.href,{method:"POST",body:o,headers:{"x-requested-with":"XMLHttpRequest"}}).then(function(o){return e.checkResponse(o),o.json()}).then(function(o){"success"===o.status?(e.bookingWindow.message.success=o.message.success,window.setTimeout(function(){e.mode="main-window"},2500)):e.bookingWindow.message.error=o.message.error,e.bookingWindow.deleteBookingsWithSameBookingUuid=!1,e.bookingWindow.showConfirmationMsg=!0,e.fetchDataRequest()}).catch(function(o){e.isReady=!1,e.bookingWindow.showConfirmationMsg=!0,e.fetchDataRequest(),e.bookingWindow.deleteBookingsWithSameBookingUuid=!1})},jumpWeekRequest:function(e,o){return o.preventDefault(),o.stopPropagation(),!this.isBusy&&(!(e===this.activeWeekTstamp||e<this.filterBoard.tstampFirstPossibleWeek||e>this.filterBoard.tstampLastPossibleWeek)&&void(this.activeWeekTstamp=e))},openBookingWindow:function(e,o){let t=this;t.mode="booking-window",t.bookingWindow.deleteBookingsWithSameBookingUuid=!1,t.bookingWindow.selectedTimeSlots=[],t.bookingWindow.action=o,t.bookingWindow.showConfirmationMsg=!1,t.bookingWindow.activeTimeSlot=e,t.bookingWindow.message={success:null,error:null},t.bookingWindow.selectedTimeSlots.push(e.bookingCheckboxValue),t.bookingFormValidation=[],$(t.$el).find(".booking-preview").first().collapse("hide"),window.setTimeout(function(){t.bookingFormValidationRequest()},500),t.mode="booking-window",$(t.$el).find('.booking-window [name="bookingDescription"]').first().val(""),$(t.$el).find(".booking-window .booking-repeat-stop-week-tstamp option").prop("selected",!1)},hideBookingWindow:function(){this.mode="main-window"},toggleBackdrop:function(e=!0){if(e){$(".resource-booking-backdrop-layer").remove();let e='<div class="resource-booking-backdrop-layer show"></div>';$("body").append(e)}else window.setTimeout(function(){$(".resource-booking-backdrop-layer").remove()},100)},checkResponse:function(e){this.lastResponseStatus=e.status,200!=e.status?this.isReady=!1:this.isReady=!0},initializeIdleDetector:function(e){let o=this;$(document).idle({onIdle:function(){o.isIdle=!0},onActive:function(){o.isIdle=!1,o.fetchDataRequest()},idle:e})}}})}}
